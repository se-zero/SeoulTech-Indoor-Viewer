// 지도 초기화 및 OpenStreetMap 타일 추가
function initializeMap() {
    const map = L.map('map', {
        center: [37.6325, 127.0774], 
        zoom: 16,
        minZoom: 16,
        maxZoom: 19
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    const bounds = L.latLngBounds(
        [37.6275, 127.0735],
        [37.6365, 127.0825]
    );
    map.setMaxBounds(bounds);

    return map;
}

// 초기화 함수 호출
const map = initializeMap();

import { handleBuildingClick } from './buildingController.js'; 

const buildings = [
    // 학교 테두리
    {
        name: "Seoul_Tech",
        coordinates: [
        [37.6308286, 127.0753907],
        [37.6327085, 127.0760787],
        [37.6332693, 127.0762449],
        [37.6333532, 127.0760867],
        [37.6344939, 127.0764582],
        [37.6346659, 127.0763750],
        [37.6350079, 127.0752579],
        [37.6361655, 127.0755234],
        [37.6364761, 127.0759275],
        [37.6365277, 127.0761819],
        [37.6364607, 127.0764112],
        [37.6361278, 127.0766624],
        [37.6359664, 127.0768877],
        [37.6356918, 127.0773581],
        [37.6357258, 127.0777631],
        [37.6361995, 127.0792490],
        [37.6361788, 127.0797523],
        [37.6360402, 127.0801744],
        [37.6358703, 127.0806625],
        [37.6356987, 127.0809808],
        [37.6353860, 127.0813814],
        [37.6350121, 127.0817462],
        [37.6345172, 127.0821324],
        [37.6337440, 127.0826367],
        [37.6334488, 127.0828271],
        [37.6331811, 127.0829505],
        [37.6328774, 127.0830068],
        [37.6321743, 127.0829129],
        [37.6315923, 127.0828325],
        [37.6314871, 127.0828506], 
        [37.6313671, 127.0830001],
        [37.6309890, 127.0831141],
        [37.6309890, 127.0831141],
        [37.6310570, 127.0824744],
        [37.6310410, 127.0824261],
        [37.6310071, 127.0823912],
        [37.6300926, 127.0821083],
        [37.6297909, 127.0820197],
        [37.6288903, 127.0817623],
        [37.6284527, 127.0816670],
        [37.6282062, 127.0815772],
        [37.6282105, 127.0814900],
        [37.6285408, 127.0810810],
        [37.6285266, 127.0792160],
        [37.6284888, 127.0774814],
        [37.6292116, 127.0770057],
        [37.6298610, 127.0766245],
        [37.6299534, 127.0766084],
        [37.6300044, 127.0766325],
        [37.6300639, 127.0767090],
        [37.6301494, 127.0766613],
        [37.6302827, 127.0765802],
        [37.6302816, 127.0764904],
        [37.6302954, 127.0764273],
        [37.6303363, 127.0763542],
        [37.6306279, 127.0760961],
        [37.6307054, 127.0759083],
        [37.6307776, 127.0754738]
    ],
    color: 'gray', // 기본 테두리 색상
    fillColor: 'gray',
    fillOpacity: 0,
    alwaysVisible: true // hover 효과 적용
    },
    // 대학본부 테두리(1)
    {
        name: "Administration_Bldg",
        tooltipName: "대학본부",
        coordinates: [
            [37.6320098, 127.0802138],
            [37.6319318, 127.0801887],
            [37.6319537, 127.0801012],
            [37.6317589, 127.0800319],
            [37.6316232, 127.0806804],
            [37.6316350, 127.0809399],
            [37.6317270, 127.0809299],
            [37.6317233, 127.0807591],
            [37.6316457, 127.0807301],
            [37.6316475, 127.0806902],
            [37.6317261, 127.0807091],
            [37.6317665, 127.0805223],
            [37.6318583, 127.0805504],
            [37.6318815, 127.0804461],
            [37.6319468, 127.0804649], 
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 다산관 테두리(2) 
    {
        name: "Dasan_Hall",
        tooltipName: "다산관",
        coordinates: [
            [37.6325900, 127.0786554],
            [37.6328206, 127.0776820],
            [37.6323339, 127.0774982],
            [37.6322294, 127.0779417],
            [37.6321532, 127.0778460],
            [37.6321089, 127.0780337],
            [37.6321996, 127.0780678],
            [37.6321049, 127.0784721]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 창학관 테두리(3) 
    {
        name: "Changhak_Hall",
        tooltipName: "창학관",
        coordinates: [
            [37.6327523, 127.0791205],
            [37.6325168, 127.0801108],
            [37.6320295, 127.0799457],
            [37.6322718, 127.0789447]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 혜성관 테두리(5)
    {
        name: "Hyesung_Hall",
        tooltipName: "혜성관",
        coordinates: [
            [37.6317056, 127.0812730],
            [37.6315856, 127.0812828],
            [37.6316115, 127.0818631],
            [37.6315332, 127.0818733],
            [37.6315393, 127.0820592],
            [37.6316193, 127.0820510],
            [37.6316260, 127.0822208],
            [37.6317419, 127.0822129],
            [37.6317270, 127.0819131],
            [37.6318660, 127.0819051],
            [37.6318867, 127.0824970],
            [37.6319964, 127.0824895],
            [37.6319722, 127.0819213],
            [37.6319931, 127.0819169],
            [37.6319858, 127.0817576],
            [37.6318618, 127.0817717],
            [37.6318636, 127.0818569],
            [37.6317268, 127.0818637]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 청운관 테두리(6)
    {
        name: "Chungun_Hall",
        tooltipName: "청운관",
        coordinates: [
            [37.6334830, 127.0803316],
            [37.6333883, 127.0802955],
            [37.6331674, 127.0812302],
            [37.6332644, 127.0812651],
            [37.6332429, 127.0813423],
            [37.6337444, 127.0814992],
            [37.6339538, 127.0805982],
            [37.6339163, 127.0805794],
            [37.6339515, 127.0804279],
            [37.6335037, 127.0802655]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 테크노 파크 테두리(7)
    {
        name: "Technopark",
        tooltipName: "테크노파크",
        coordinates: [
            [37.6347116, 127.0805972],
            [37.6345906, 127.0811161],
            [37.6343488, 127.0810357],
            [37.6344779, 127.0805180]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    {
        name: "Technopark",
        tooltipName: "테크노파크",
        coordinates: [
            [37.6351589, 127.0802750],
            [37.6350896, 127.0806015],
            [37.6344418, 127.0803825],
            [37.6345110, 127.0800559]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 창조관 테두리(8)
    {
        name: "Chanjo_Hall",
        tooltipName: "창조관",
        coordinates: [
            [37.6349717, 127.0790509],
            [37.6347906, 127.0797974],
            [37.6346527, 127.0797418],
            [37.6347346, 127.0793943],
            [37.6346540, 127.0793634],
            [37.6346756, 127.0792757],
            [37.6347597, 127.0793083],
            [37.6348415, 127.0789993]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 프론티어관 테두리(32) 
    {
        name: "Frontier_Hall",
        tooltipName: "프론티어관",
        coordinates: [
            [37.6314836, 127.0765751],
            [37.6313271, 127.0765272],
            [37.6314024, 127.0761670],
            [37.6310842, 127.0760628],
            [37.6311385, 127.0758419],
            [37.6316058, 127.0760002]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 하이테크관 테두리(33) 
    {
        name: "Hi_Tech_Hall",
        tooltipName: "하이테크관",
        coordinates: [
            [37.6323620, 127.0769686],
            [37.6324662, 127.0764924],
            [37.6325294, 127.0765144],
            [37.6325829, 127.0762701],
            [37.6317930, 127.0759945],
            [37.6317804, 127.0760520],
            [37.6316975, 127.0761074],
            [37.6315640, 127.0767175],
            [37.6317623, 127.0767867],
            [37.6318661, 127.0763121],
            [37.6322688, 127.0764526],
            [37.6321705, 127.0769061],
            [37.6323620, 127.0769686]
        ],
        color: 'red',
        alwaysVisible: false 
    },
    // 중앙도서관(34)
    {
        name: "Centeral_Library",
        tooltipName: "중앙도사관",
        coordinates: [
            [37.6333099, 127.0764548],
            [37.6331282, 127.0772375],
            [37.6327627, 127.0771022],
            [37.6329443, 127.0763196]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    //도서관 별관(35)
    {
        name: "Centeral_Library_Annex",
        tooltipName: "도사관 별관",
        coordinates: [
            [37.6340165, 127.0765358],
            [37.6339032, 127.0770005],
            [37.6333594, 127.0767985],
            [37.6334659, 127.0763225],
            [37.6336956, 127.0764070],
            [37.6336925, 127.0764307],
            [37.6338639, 127.0764982],
            [37.6338698, 127.0764802]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 제1학생회관 테두리(37)
    {
        name: "Student_Union_Bldg1",
        tooltipName: "제1학생회관",
        coordinates: [
            [37.6343732, 127.0766948],
            [37.6342073, 127.0773620],
            [37.6340131, 127.0772888],
            [37.6341029, 127.0769000],
            [37.6340631, 127.0768832],
            [37.6341332, 127.0766047]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 국제관 테두리(38)
    {
        name: "International_Hall",
        tooltipName: "국제관",
        coordinates: [
            [37.6348813, 127.0771873],
            [37.6347660, 127.0776671],
            [37.6353372, 127.0778670],
            [37.6353609, 127.0777596],
            [37.6353298, 127.0777479],
            [37.6353426, 127.0776949],
            [37.6352851, 127.0776735],
            [37.6352933, 127.0776393],
            [37.6349935, 127.0775256],
            [37.6350457, 127.0772882],
            [37.6349908, 127.0772703],
            [37.6349987, 127.0772296]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 다빈치관 테두리(39)
    {
        name: "Davinch_Hall",
        tooltipName: "다빈치관",
        coordinates: [
            [37.6352657, 127.0782501],
            [37.6351105, 127.0789655],
            [37.6352023, 127.0789992],
            [37.6352394, 127.0788295],
            [37.6352996, 127.0788532],
            [37.6352705, 127.0789817],
            [37.6354932, 127.0790667],
            [37.6355580, 127.0788119],
            [37.6354277, 127.0787658],
            [37.6354760, 127.0785614],
            [37.6353843, 127.0785315],
            [37.6354342, 127.0783050]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 어의관 테두리(40)
    {
        name: "Eoui_Hall",
        tooltipName: "어의관",
        coordinates: [
            [37.6357922, 127.0767958],
            [37.6357299, 127.0770125],
            [37.6348364, 127.0766788],
            [37.6349058, 127.0764499]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 불암학사 테두리(41)
    {
        name: "Buram_Dormitory",
        tooltipName: "불암학사",
        coordinates: [
            [37.6362649, 127.0763789],
            [37.6363071, 127.0761847],
            [37.6362912, 127.0761788],
            [37.6362792, 127.0761644],
            [37.6362731, 127.0761448],
            [37.6362744, 127.0761231],
            [37.6361704, 127.0760810],
            [37.6361985, 127.0759637],
            [37.6364040, 127.0760465],
            [37.6364355, 127.0761156],
            [37.6363549, 127.0764181]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // KB학사 테두리(42)
    {
        name: "KB_Dormitory",
        tooltipName: "KB학사",
        coordinates: [
            [37.6359547, 127.0757858],
            [37.6357840, 127.0764270],
            [37.6359126, 127.0764788],
            [37.6359200, 127.0764485],
            [37.6359462, 127.0764577],
            [37.6359625, 127.0763948],
            [37.6359364, 127.0763848],
            [37.6359443, 127.0763549],
            [37.6359848, 127.0763715],
            [37.6360018, 127.0763139],
            [37.6359617, 127.0762978],
            [37.6359736, 127.0762524],
            [37.6359964, 127.0762618],
            [37.6360149, 127.0761915],
            [37.6359912, 127.0761808],
            [37.6360062, 127.0761227],
            [37.6360292, 127.0761317],
            [37.6360469, 127.0760630],
            [37.6360232, 127.0760528],
            [37.6360294, 127.0760260],
            [37.6360723, 127.0760434],
            [37.6360862, 127.0759882],
            [37.6360454, 127.0759741],
            [37.6360548, 127.0759334],
            [37.6360788, 127.0759417],
            [37.6360986, 127.0758688],
            [37.6360707, 127.0758591],
            [37.6360785, 127.0758290]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 성림학사(1) 테두리(43)
    {
        name: "Sunglim_Dormitory",
        tooltipName: "성림학사",
        coordinates: [
            [37.6356947, 127.0757487],
            [37.6355280, 127.0764316],
            [37.6353227, 127.0763523],
            [37.6354301, 127.0759057],
            [37.6354593, 127.0758897],
            [37.6354803, 127.0758028],
            [37.6353656, 127.0757588],
            [37.6353803, 127.0757006],
            [37.6353460, 127.0756849],
            [37.6353633, 127.0756182]
        ],
        color: 'pink', 
        alwaysVisible: false
    },
    // 성림학사(2) 테두리(43)
    {
        name: "Sunglim_Dormitory",
        tooltipName: "성림학사",
        coordinates: [
            [37.6350947, 127.0755043],
            [37.6349579, 127.0760153],
            [37.6349933, 127.0760337],
            [37.6349244, 127.0762766],
            [37.6350710, 127.0763430],
            [37.6351385, 127.0760792],
            [37.6350933, 127.0760600],
            [37.6352258, 127.0755657]

        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 수림학사 테두리(45)
    {
        name: "soolim_Dormitory",
        tooltipName: "수림학사",
        coordinates: [
            [37.6360292, 127.0777888],
            [37.6357830, 127.0779180],
            [37.6360636, 127.0787128],
            [37.6363028, 127.0785632]

        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 누리학사 테두리(46)
    {
        name: "Noori_Dormitory",
        tooltipName: "누리학사",
        coordinates: [
            [37.6348032, 127.0768705],
            [37.6346166, 127.0767965],
            [37.6346241, 127.0767670],
            [37.6345190, 127.0767239],
            [37.6343514, 127.0773955],
            [37.6344901, 127.0774501],
            [37.6345094, 127.0773739],
            [37.6345423, 127.0773857],
            [37.6345619, 127.0773004],
            [37.6345296, 127.0772901],
            [37.6345645, 127.0771556],
            [37.6346044, 127.0771710],
            [37.6346324, 127.0770600],
            [37.6345785, 127.0770376],
            [37.6345893, 127.0769916],
            [37.6347627, 127.0770507]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 100주년 기념관 테두리 (51)
    {
        name: "The_100th_Memorial_Hall",
        tooltipName: "백주년 기념관",
        coordinates: [
            [37.6305389, 127.0777960],
            [37.6304807, 127.0781132],
            [37.6303637, 127.0787947],
            [37.6308211, 127.0789201],
            [37.6308652, 127.0785958],
            [37.6308818, 127.0785956],
            [37.6308834, 127.0784890],
            [37.6308662, 127.0784887],
            [37.6308270, 127.0782188],
            [37.6307898, 127.0782530],
            [37.6307912, 127.0783015],
            [37.6307637, 127.0783912],
            [37.6305915, 127.0783427],
            [37.6306635, 127.0779156]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 제2학생회관(52)
    {
        name: "Student_Union_Bldg2",
        tooltipName: "제2 학생회관",
        coordinates: [
            [37.6306327, 127.0789716],
            [37.6305554, 127.0794253],
            [37.6309146, 127.0794986],
            [37.6309462, 127.0793087],
            [37.6309204, 127.0793012],
            [37.6309444, 127.0791534],
            [37.6308342, 127.0791289],
            [37.6308515, 127.0790256]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 상상관 테두리(53)
    {
        name: "Sangsang_Hall",
        tooltipName: "상상관",
        coordinates: [
            [37.6310283, 127.0809080],
            [37.6307617, 127.0808288],
            [37.6309125, 127.0799316],
            [37.6310498, 127.0799751],
            [37.6310654, 127.0800501],
            [37.6310686, 127.0801057]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 아름관 테두리(54)
    {
        name: "Areum_Hall",
        tooltipName: "아름관",
        coordinates: [
            [37.6296609, 127.0803007],
            [37.6295793, 127.0808132],
            [37.6296428, 127.0808271],
            [37.6295794, 127.0808643],
            [37.6295929, 127.0809068],
            [37.6296316, 127.0808850],
            [37.6296488, 127.0809258],
            [37.6299844, 127.0810070],
            [37.6299825, 127.0810445],
            [37.6303082, 127.0811160],
            [37.6303777, 127.0810735],
            [37.6303303, 127.0810112],
            [37.6304278, 127.0810209],
            [37.6305106, 127.0805097],
            [37.6303462, 127.0804754],
            [37.6302702, 127.0809330],
            [37.6302039, 127.0808849],
            [37.6301087, 127.0808353],
            [37.6301074, 127.0808998],
            [37.6300107, 127.0808886],
            [37.6299196, 127.0808607],
            [37.6299328, 127.0808119],
            [37.6298307, 127.0808037],
            [37.6297609, 127.0808083],
            [37.6298414, 127.0803178],
            [37.6297885, 127.0803058],
            [37.6297860, 127.0803287]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 체육관 테두리(55)
    {
        name: "University_Gymnasium",
        tooltipName: "체육관",
        coordinates: [
            [37.6294146, 127.0794395],
            [37.6293676, 127.0796621],
            [37.6292067, 127.0798045],
            [37.6290033, 127.0797531],
            [37.6288883, 127.0795669],
            [37.6289324, 127.0793020],
            [37.6291029, 127.0791570],
            [37.6292936, 127.0792087]
        ],
        color: 'pink', 
        alwaysVisible: false 
    },
    // 대륙관 테두리(56)
    {
        name: "Daeryuk_Hall",
        tooltipName: "대륙관",
        coordinates: [
            [37.6295261, 127.0799221],
            [37.6294966, 127.0801010],
            [37.6293927, 127.0801904],
            [37.6293600, 127.0803812],
            [37.6294007, 127.0803919],
            [37.6293885, 127.0804756],
            [37.6293465, 127.0804669],
            [37.6292926, 127.0807562],
            [37.6293925, 127.0807801],
            [37.6293619, 127.0809544],
            [37.6291341, 127.0809017],
            [37.6291618, 127.0807230],
            [37.6292381, 127.0807430],
            [37.6292533, 127.0806602],
            [37.6291287, 127.0806226],
            [37.6292374, 127.0800567],
            [37.6292726, 127.0800434],
            [37.6293058, 127.0798671]

        ],
        color: 'pink', 
        alwaysVisible: false
    },
    // 무궁관 테두리(57)
    {
        name: "Mugung_Hall",
        tooltipName: "무궁관",
        coordinates: [
            [37.6307090, 127.0811898],
            [37.6305968, 127.0819245],
            [37.6307809, 127.0819673],
            [37.6308942, 127.0812341]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 무궁관A 테두리(57)
    {
        name: "Mugung_Hall_A",
        tooltipName: "무궁관A",
        coordinates: [
            [37.6305556, 127.0812903],
            [37.6303887, 127.0812484],
            [37.6303019, 127.0818109],
            [37.6304688, 127.0818511]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 미래관 테두리(60)
    {
        name: "Mirae_Hall",
        tooltipName: "미래관",
        coordinates: [
            [37.6297845, 127.0812884],
            [37.6296967, 127.0817586],
            [37.6293290, 127.0816422],
            [37.6293122, 127.0817413],
            [37.6290979, 127.0816899],
            [37.6290924, 127.0816212],
            [37.6289998, 127.0816179],
            [37.6290235, 127.0810866],
            [37.6291132, 127.0810866],
            [37.6291131, 127.0811428],
            [37.6291920, 127.0811465],
            [37.6292042, 127.0810592],
            [37.6293206, 127.0810901],
            [37.6292529, 127.0814643],
            [37.6295617, 127.0815608],
            [37.6295926, 127.0814181],
            [37.6295932, 127.0813268],
            [37.6295941, 127.0812569],
            [37.6296126, 127.0812256],
            [37.6296345, 127.0812104],
            [37.6297409, 127.0812584],
            [37.6297415, 127.0812793],
            [37.6297845, 127.0812884]
        ],
        color: 'red', 
        alwaysVisible: false 
    },
    // 테크노큐브 테두리(62)
    {
        name: "Techno_Cube",
        tooltipName: "테크노큐브",
        coordinates: [
            [37.6300431, 127.0797316],
            [37.6297769, 127.0796636],
            [37.6296920, 127.0801573],
            [37.6299593, 127.0802182],
        ],
        color: 'red', 
        alwaysVisible: false 
    }
]


// 공통 hover 효과 적용 함수
function applyHoverEffect(layer, building) {
    if (building.alwaysVisible) {
        // 항상 테두리가 표시되도록 기본 스타일 설정
        layer.setStyle({
            color: building.color,
            weight: 2
        });
        return;
    }

    // 건물의 테두리 좌표를 가져오기
    const coordinates = building.coordinates;
    const topmostCoordinate = coordinates.reduce((topmost, coord) => {
        return coord[0] > topmost[0] ? coord : topmost; // 위도가 가장 큰 좌표 찾기
    }, coordinates[0]);
     
    // 마우스를 올릴 때
    layer.on('mouseover', function () {
        layer.setStyle({
            color: building.color, // 건물별 색상 적용
            fillColor:building.color,
            weight: 3 // 테두리 두께
        });

        // 툴팁을 가장 위쪽 좌표로 이동
        layer.bindTooltip(building.tooltipName, {
            permanent: false,
            direction: 'top',
            offset: L.point(8, -5), 
            className: 'custom-tooltip'
        });

        // 툴팁의 위치를 최상단 좌표로 설정
        layer.openTooltip(L.latLng(topmostCoordinate));
    });

    // 마우스를 벗어날 때
    layer.on('mouseout', function () {
        layer.setStyle({
            color: 'transparent', // 테두리 숨기기
            fillColor:'transparent',
            weight: 0 // 테두리 두께 제거
        });
        layer.unbindTooltip(); // 툴팁 제거
    });

    
}

// 반복문으로 건물 추가
buildings.forEach(building => {
    const buildingLayer = L.polygon(building.coordinates, {
        color: building.alwaysVisible ? building.color : 'transparent', // 기본 테두리 설정
        fillColor: building.fillColor || 'transparent',
        fillOpacity: building.fillOpacity || 0.2
    }).addTo(map);

    // 클릭 이벤트 등록
    buildingLayer.on('click', function () {
        handleBuildingClick(building.name);
    });

    // hover 효과 적용
    applyHoverEffect(buildingLayer, building);
});